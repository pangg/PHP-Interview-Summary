一、 分区表的原理
    （1）工作原理
        对用户而言，分区表是一个独立的逻辑表，但是底层MySQL将其分成了多个物理子表，
        这对用户来说是透明的，每一个分区表都会使用一个独立的表文件

        创建表时使用partition by子句定义每个分区存放的数据，执行查询时，优化器会根据分区定义
        过滤那些没有我们需要数据的分区，这样查询只需要查询所需数据在的分区即可

        分区的主要目的是将数据按照一个较粗的粒度分在不同的表中，
        这样可以将相关的数据存放在一起，而且如果想一次性删除整个分区的数据也很方便

    （2）使用场景
        1.表非常大，无法全部存在内存，或者只在表的最后有热点数据，其他都是历史数据
        2.分区表的数据更易维护，可以对独立的分区进行独立的操作
        3.分区表的数据可以分布在不同的机器上，从而高效使用资源
        4.可以使用分区表来避免某些特殊的瓶颈
        5.可以备份和恢复独立的分区

    （3）限制
        1.一个表最多只能有1024个分区
        2. 5.1版本中，分区表表达式必须是整数，5.5可以使用列分区
        3. 分区字段中如果有主键和唯一索引列，那么主键列和唯一列都必须包含进来
        4. 分区表中无法使用外键约束
        5. 需要对现有表的结构进行修改
        6. 所有分区都必须使用相同的存储引擎
        7. 分区函数中可以使用的函数和表达式会有一些限制
        8. 某些存储引擎不支持分区
        9. 对于MyISAM的分区表，不能使用load index into cache
        10. 对于MyISAM表，使用分区表时需要打开更多的文件描述符

二、 分库分表的原理
    （1）工作原理
        通过一些hash算法或者工具实现将一张数据表垂直或者水平进行物理切分

    （2）适用场景
        1. 单表记录条数达到百万到千万级别时
        2. 解决表锁的问题

    （3）分表方式
        1. 水平分割：
            表很大，分割后可以降低在查询时需要读的数据和索引的页数，
            同时也降低了索引的层数，提高查询速度

        2. 使用场景
            （1）表中的数据本身就有独立性，例如表中分别记录各个地区的数据
                或者不同时期的数据，特别是有些数据常用，有些不常用
            （2）需要把数据存放在多个介质上
        3. 水平分表缺点
            （1）给应用增加复杂度，通常查询时需要多个表名，
                查询所有数据都需union操作
            （2）在许多数据库应用中，这种复杂性会超过他带来的有点，
                查询时会增加读一个索引层的磁盘次数


    （4）垂直分表
        1. 分表方式
            垂直分表
            把主键和一些列放在一个表，然后把主键和另外的列放在另一个表中
        2. 使用场景
            （1）如果一个表中某些列常用，而另外一些列不常用
            （2）可以使数据行变小，一个数据页能存储更多数据，查询时减少i/o次数
        3. 垂直分表缺点
            管理冗余列，查询所有数据需要join操作

    （5）分表缺点
        1. 有些分表的策略基于应用层的逻辑算法，一旦逻辑算法改变，
            整个分表逻辑都会改变，扩展性较差
        2. 对于应用层来说，逻辑算法无疑增加开发成本

三、MySQL的复制原理及负载均衡
    1. MySQL主从复制工作原理：
        在主库上把数据更改记录到二进制日志
        从库将主库的日志复制到自己的中继日志
        从库读取中继日志中的事件，将其重放到从库数据中
    2. MySQL主从复制解决的问题
        数据分布：随意停止或开始复制，并在不同地理位置分布数据备份
        负载均衡：降低单个服务器的压力
        高可用和故障切换：帮助应用程序避免单点失败
        升级测试：可以使用更高版本的MySQL作为从库


四、DB主从一致性的几种解决方法
    1. 半同步复制
        主从不一致的原因是延时引起的,所以要消除这个延时的影响，可以从主库进行CUD操作时进行规避，
        办法就是等主从同步完成之后，主库上的写请求再返回，就是大家常说的“半同步复制”semi-sync。

        方案优点：利用数据库原生功能，比较简单
        方案缺点：主库的写请求时延会增长，吞吐量会降低

    2. 数据库中间件
        方案优点：能保证绝对一致
        方案缺点：数据库中间件的成本比较高

    3. 缓存记录写key法
        CUD操作: 将某个库上的某个key要发生写操作，记录在cache里，并设置“经验主从同步时间”的cache超时时间;
        R操作: (1）先到cache里查看，对应库的对应key有没有相关数据
             （2）如果cache hit，有相关数据，说明这个key上刚发生过写操作，此时需要将请求路由到主库读最新的数据
             （3）如果cache miss，说明这个key上近期没有发生过写操作，此时将请求路由到从库，继续读写分离
            方案优点：相对数据库中间件，成本较低
            方案缺点：为了保证“一致性”，引入了一个cache组件，并且读写数据库时都多了一步cache操作























